<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>League</title>
    <script type="text/javascript" src="js/d3.v7.min.js"></script>
    <script type="text/javascript" src="js/toolbox.js"></script>
    <script type="text/javascript" src="js/league.js"></script>

    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/league.css">
    
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&" as="style" onload="this.onload=null;this.rel='stylesheet'">
</head>
<body>
    <div id="loading-screen" style="display: none;">
        <div class="spinner"></div>
        <p>Loading data, please wait...</p>
    </div>
    <div class="season">
        <label for="season"></label>
        <select id="season">
            <option value="2021-2022">2021-2022</option>
            <option value="2022-2023">2022-2023</option>
            <option value="2023-2024" selected>2023-2024</option>
        </select>
    </div>
    
    <menu>
        <a href="index.html" class="material-symbols-outlined back-to-map" title="Back to map">explore</a>
        <a href="matches.html" class="material-symbols-outlined view-matches" title="View matches">sports_soccer</a>
    </menu>

    <main>
        <div class="league-selector">
            <div class="league-wrapper" name="Premier League">
                <img src="data/img/Leagues/Premier League.png" alt="Premier League" class="league-logo">
            </div>
    
            <div class="league-wrapper" name="Ligue 1">
                <img src="data/img/Leagues/Ligue 1.jpg  " alt="Ligue 1" class="league-logo">
            </div>
    
            <div class="league-wrapper" name="Bundesliga">
                <img src="data/img/Leagues/Bundesliga.png" alt="Bundesliga" class="league-logo">
            </dicv>
    
            <div class="league-wrapper" name="Serie A">
                <img src="data/img/Leagues/Serie A.png" alt="Serie A" class="league-logo">
            </div>
    
            <div class="league-wrapper" name="La Liga">
                <img src="data/img/Leagues/La Liga.png" alt="La Liga" class="league-logo">
            </div>
        </div>

        <div class="data-block">
            <h1>Current League</h1>
            <div class="tab">
                <button class="tablinks" onclick="openTab(event, 'TopTeams')" id="defaultOpen">Top Teams</button>
                <button class="tablinks" onclick="openTab(event, 'TopPlayers')">Top Players</button>
            </div>
    
            <!-- Top Teams Tab Content -->
            <div id="TopTeams" class="tabcontent">
                <!-- Top Three Teams Section -->
                <div class="top-teams">
                    <h2>Top 3 Teams</h2>
                    <ul id="top-teams-list">
                        <!-- Top teams will be populated here -->
                    </ul>
                </div>
                <!-- League Stats Section -->
                <div class="league-stats">
                    <h2>League Table</Table></h2>
                    <table id="league-stats-table">
                        <thead>
                            <tr>
                                <th>Team</th>
                                <th>Wins</th>
                                <th>Losses</th>
                                <th>Draws</th>
                                <th>Points</th>
                                <th>Goals Scored</th>
                                <th>Goals Conceded</th>  
                                <th>Goals Diff</th>
                            </tr>
                        </thead>
                        <tbody id="league-stats-body">
                            <!-- League stats will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
    
            <!-- Top Players Tab Content -->
            <div id="TopPlayers" class="tabcontent">
                <div class="top-players-container">
                    <div class="top-players">
                        <h2>Top Scorers</h2>
                        <ul id="top-players-list">
                            <!-- Top players will be populated here -->
                        </ul>
                    </div>
                    <div class="top-assists">
                        <h2>Top Assists</h2>
                        <ul id="top-assists-list">
                            <!-- Top assists will be populated here -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
    </main>

    <script>
        let tutorial_running = false;
        url = new URL(window.location.href);
        tutorial = url.searchParams.get("tutorial");
        if (tutorial && !tutorial_running) {
            tutorial_running = true;
            tuto_step_1()
        }

        function tuto_step_1() {
            message = `
                <h3 class="title">Welcome to the Team Comparison Page</h3>
                <p class="content">Compare two teams based on various performance metrics here.</p>
                <p style="display: flex; gap: 4px; align-items: center;">Click the <span class="material-symbols-outlined">explore</span> icon to return to the map.</p>
                <p>To switch seasons, simply select one from the dropdown (top left corner).</p>
            `

            pop_up_next(message, tuto_step_2)
        }

        function tuto_step_2() {
            message = `
                <h3 class="title">Team Comparison</h3>
                <p class="content">Select a second team from the dropdown to compare them with the first team.</p>
            `

            pop_up_wrapper = pop_up_showcase(message)
            pop_up = d3.select(".pop-up")
            pop_up.style("transition", "all 0.5s ease-in-out")
            translate_x = window.innerWidth - pop_up.node().offsetWidth - 20 - pop_up.node().offsetLeft
            translate_y = window.innerHeight - pop_up.node().offsetHeight - 75 - pop_up.node().offsetTop
            pop_up.style("transform", `translate(${translate_x}px, ${-translate_y}px)`)

            // Highlight the team dropdown
            select_team2 = d3.select("#team2")
            animation_running = true

            highlight_element(select_team2)

            select_team2.on("change", function() {
                if (select_team2.property("value") == "") return
                if (animation_running) {
                    animation_running = false
                    pop_up_wrapper.remove()
                    tuto_step_3()
                }
            })
        }

        function tuto_step_3() {
            message = `
                <h3 class="title">Available Information</h3>
                <p>If both teams have faced each other, their match history will appear in the table below. It's possible to click on a row for more details.</p>
                <p>&nbsp;</p>
                <p>The performance metrics for each team will also be shown in the comparison results section.</p>
                <p>&nbsp;</p>
                <p style="display: flex; gap: 4px; align-items: center;">Next, weâ€™ll explore the matches. Click the <span class="material-symbols-outlined">sports_soccer</span> icon to view them.</p>

                <button onclick="tuto_step_4()" class="next-button">Explore!</button>
            `
            matches_button = d3.select(".view-matches")
            url = "matches.html?tutorial=true"
            matches_button.attr("href", url)

            pop_up_showcase(message)
        }

        function tuto_step_4() {
            d3.select(".pop-up-wrapper").remove()
            animation_running = true
            matches_button = d3.select(".view-matches")
            highlight_element(matches_button)
        }

        function highlight_element(element) {
            element.transition()
                .duration(400)
                .style("border-color", "var(--accent-color)")
                .transition()
                .duration(400)
                .style("border-color", "")
                .on("end", function() {
                    if (animation_running) highlight_element(element)
                })
        }

        // Script to handle tabs
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Set default tab
        document.getElementById("defaultOpen").click();
    </script>
</body>
</html>
